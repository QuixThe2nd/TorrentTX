<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Deploy Smart Contract</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/theme/material-darker.min.css">
    <style>
      body {
        background-color: #332f3d;
        color: #fff;
        font-family: Arial, sans-serif;
      }
      a {
        color: #4d88ff;
        text-decoration: none;
        margin-bottom: 1rem;
        display: block;
      }
      .CodeMirror {
        height: 50vh;
      }
    </style>
  </head>
  <body>
    <h1>Deploy Smart Contract</h1>
    <a href="index.html">Back</a>
    <textarea id="code" name="code">const contract = (instruction) => {
  if (instruction.method === 'deposit') {
    if (!store[instruction.from])
      store[instruction.from] = 0;
    store[instruction.from] += instruction.amount;
  } else if (instruction.method === 'withdraw') {
    if (store[instruction.from] < instruction.amount)
      return console.error('Insufficient funds');
    store[instruction.from] -= instruction.amount;
    send(instruction.from, instruction.amount);
  } else {
    console.error('Method not found');
  }
}</textarea>
    <button id="deploy">Deploy</button>
    <button id="test">Test</button>
    <h2>Test Instruction</h2>
    <div style="height: 200px;overflow: hidden;">
    <textarea id="instruction" name="instruction">
{
  "from": "0x",
  "contract": "${this}",
  "method": "deposit",
  "amount": 2
}
</textarea>
  </div>
  <h2>Store</h2>
  <div style="height: 200px;overflow: hidden;">
    <textarea id="store" name="store">
{
}
</textarea>
  </div>
    <h2>Examples:</h2>
    <p>Token:</p>
    <pre>
      <code>
const contract = (instruction) => {
  const mintRatio = 1000; // 1 TTX = 1000 Doggy
  const burnDiscount = 2; // 1000 Doggy = 1/2 TTX

  if (instruction.method === 'transfer') {
    if(instruction.amount > store[instruction.from]) return;
    store[instruction.from] -= instruction.amount;
    if(!store[instruction.to]) store[instruction.to] = 0;
    store[instruction.to] += instruction.amount;

  } else if (instruction.method === 'deposit') { // Mint
    if(!store[instruction.from]) store[instruction.from] = 0;
    store[instruction.from] += instruction.amount * 1000;

  } else if (instruction.method === 'burn') {
    if(instruction.amount > store[instruction.from]) return;
    store[instruction.from] -= instruction.amount;
    send(instruction.from, instruction.amount / mintRatio / burnDiscount);

  } else {
    console.error('Method not found');
  }
}

const meta = {
  ticker: "DOGGY",
  name: "Doggy",
  type: "Token"
};
      </code>
    </pre>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/edit/closebrackets.min.js"></script>
    <script>
      const editor = CodeMirror.fromTextArea(document.getElementById('code'), {
        lineNumbers: true,
        mode: 'javascript',
        theme: 'material-darker',
        autoCloseBrackets: true
      });
      const editor2 = CodeMirror.fromTextArea(document.getElementById('instruction'), {
        lineNumbers: true,
        mode: 'json',
        theme: 'material-darker',
        autoCloseBrackets: true,
      });
      const editor3 = CodeMirror.fromTextArea(document.getElementById('store'), {
        lineNumbers: true,
        mode: 'json',
        theme: 'material-darker',
        autoCloseBrackets: true,
      });

      document.getElementById('deploy').addEventListener('click', function () {
        const code = editor.getValue();
        window.electronAPI.sendMessageToMain(
          JSON.stringify({
            type: 'deploySmartContract',
            code: code
          })
        );
      });

      document.getElementById('test').addEventListener('click', function () {
        var editor = CodeMirror.fromTextArea(document.getElementById('store'), {
          lineNumbers: true,
          mode: 'json',
          theme: 'material-darker',
          autoCloseBrackets: true,
        });
        editor.getDoc().setValue(JSON.stringify(
          eval(`
            const store = ${document.getElementById('store').value};
            ${document.getElementById('code').value};
            contract(${document.getElementById('instruction').value});
            store
          `)
        , null, 2));
      });
    </script>
  </body>
</html>
