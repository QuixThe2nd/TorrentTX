<!DOCTYPE html>
<html>
<head>
    <title>Electron Communication Example</title>
</head>
<body>
    <h1>TorrentTX Wallet</h1>
    <h2>Balance: <span id="balance">0</span></h2>
    <h2>Address: <span id="address">0x</span></h2>

    <div style="display: flex; gap: 1rem">
        <p>Ratio: <span id="ratio">0</span></p>
        <p>Download Speed: <span id="downloadSpeed">0B/s</span></p>
        <p>Upload Speed: <span id="uploadSpeed">0B/s</span></p>
        <p>Progress: <span id="progress">0%</span></p>
    </div>

    <table>
        <thead>
            <tr>
                <th>Transaction ID</th>
                <th>From</th>
                <th>To</th>
                <th>Amount</th>
                <th>Message</th>
            </tr>
        </thead>
        <tbody id="transactions"></tbody>
    </table>

    <div style="display: flex; gap: 1rem">
        <div>
            <h3>Peers <span id="peersCount" style="font-size: 0.8rem">(Loading)</span></h3>
            <ul id="peers" style="list-style: none; padding: 0"></ul>
        </div>

        <div>
            <h3>Mempool <span id="mempoolCount" style="font-size: 0.8rem">(Loading)</span></h3>
            <ul id="mempool" style="list-style: none; padding: 0"></ul>
        </div>

        <div>
            <h3>Seeding <span id="seedingCount" style="font-size: 0.8rem">(Loading)</span></h3>
            <ul id="seeding" style="list-style: none; padding: 0"></ul>
        </div>

        <div>
            <h3>Leeching <span id="leechingCount" style="font-size: 0.8rem">(Loading)</span></h3>
            <div id="leeching" style="list-style: none; padding: 0"></div>
        </div>
    </div>

    <div>
        <h3>Log</h3>
        <pre id="log"></pre>
    </div>

    <script>
        const log = (message) => {
            const messageElement = document.createElement('p');
            messageElement.textContent = message;
            document.getElementById('log').appendChild(messageElement);
        };

        window.electronAPI.handleMessage((event, message) => {
            document.getElementById('log').textContent = '';
            const payload = JSON.parse(atob(message));

            document.getElementById('address').textContent = payload.address;
            document.getElementById('balance').textContent = payload.balances[payload.address];

            document.getElementById('peersCount').textContent = '(' + payload.peers.length + ')';
            const peersElement = document.getElementById('peers');
            peersElement.innerHTML = '';
            for (const peer of payload.peers) {
                const peerElement = document.createElement('li');
                peerElement.textContent = peer;
                peersElement.appendChild(peerElement);
            }

            document.getElementById('mempoolCount').textContent = '(' + payload.infohashes.length + ')';
            const mempoolElement = document.getElementById('mempool');
            mempoolElement.innerHTML = '';
            for (const infohash of payload.infohashes) {
                const infohashElement = document.createElement('li');
                infohashElement.textContent = infohash;
                mempoolElement.appendChild(infohashElement);
            }

            document.getElementById('seedingCount').textContent = '(' + payload.seeding.length + ')';
            const seedingElement = document.getElementById('seeding');
            seedingElement.innerHTML = '';
            for (const infohash of payload.seeding) {
                const infohashElement = document.createElement('li');
                infohashElement.textContent = infohash;
                seedingElement.appendChild(infohashElement);
            }

            document.getElementById('leechingCount').textContent = '(' + payload.leeching.length + ')';
            const leechingElement = document.getElementById('leeching');
            leechingElement.innerHTML = '';
            for (const infohash of payload.leeching) {
                const infohashElement = document.createElement('p');
                infohashElement.textContent = infohash;
                leechingElement.appendChild(infohashElement);
            }

            document.getElementById('transactions').innerHTML = '';
            const transactions = JSON.parse(payload.transactions);
            for (const transaction of transactions) {
                const transactionElement = document.createElement('tr');
                const txIdElement = document.createElement('td');
                const fromElement = document.createElement('td');
                const toElement = document.createElement('td');
                const amountElement = document.createElement('td');
                const messageElement = document.createElement('td');

                txIdElement.textContent = transaction.hash;
                fromElement.textContent = transaction.tx.from;
                toElement.textContent = transaction.tx.to;
                amountElement.textContent = transaction.tx.amount;
                messageElement.textContent = transaction.tx.message;

                if (transaction.tx.from === payload.address) {
                    fromElement.style.backgroundColor = 'lightgreen';
                } else if (transaction.tx.to === payload.address) {
                    toElement.style.backgroundColor = 'lightgreen';
                }

                transactionElement.appendChild(txIdElement);
                transactionElement.appendChild(fromElement);
                transactionElement.appendChild(toElement);
                transactionElement.appendChild(amountElement);
                transactionElement.appendChild(messageElement);

                document.getElementById('transactions').appendChild(transactionElement);
            }

            document.getElementById('ratio').textContent = payload.ratio;
            document.getElementById('downloadSpeed').textContent = payload.downloadSpeed + 'B/s';
            document.getElementById('uploadSpeed').textContent = payload.uploadSpeed + 'B/s';
            document.getElementById('progress').textContent = payload.progress + '%';
        });
    </script>
</body>
</html>
