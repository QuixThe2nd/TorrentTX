<!DOCTYPE html>
<html>
<head>
    <title>TorrentTX Wallet</title>

    <style>
        body {
            background-color: #332f3d;
            color: #fff;
            font-family: Arial, sans-serif;
        }
        a {
            color: #4d88ff;
            text-decoration: none;
            margin-bottom: 1rem;
            display: block;
        }
        .highlight-cell {
            background-color: #155b0e;
            color: #fff;
        }
    </style>
</head>
<body>
    <h1>TorrentTX Wallet</h1>
    <h2>Balance: <span id="balance">0</span></h2>
    <h2>Address: <span id="address">0x</span></h2>

    <div>
        <input type="number" id="transferAmount" placeholder="Amount" min="0">
        <input type="text" id="transferTo" placeholder="To">
        <input type="text" id="transferMessage" placeholder="Message">
        <button onclick="window.electronAPI.sendMessageToMain(JSON.stringify({
            type: 'transfer',
            amount: document.getElementById('transferAmount').value,
            to: document.getElementById('transferTo').value,
            message: document.getElementById('transferMessage').value
        }))">Transfer</button>
    </div>

    <div style="display: flex; gap: 1rem">
        <p>Ratio: <span id="ratio">0</span></p>
        <p>Download Speed: <span id="downloadSpeed">0B/s</span></p>
        <p>Upload Speed: <span id="uploadSpeed">0B/s</span></p>
        <p>Progress: <span id="progress">0%</span></p>
        <p>Connections: <span id="connections">0</span></p>
    </div>

    <table>
        <thead>
            <tr>
                <th>Transaction ID</th>
                <th>Infohash</th>
                <th>From</th>
                <th>To</th>
                <th>Amount</th>
                <th>Message</th>
            </tr>
        </thead>
        <tbody id="transactions"></tbody>
    </table>

    <div style="display: flex; gap: 1rem">
        <div>
            <h3>Peers <span id="peersCount" style="font-size: 0.8rem">(Loading)</span></h3>
            <ul id="peers" style="list-style: none; padding: 0"></ul>
        </div>

        <div>
            <h3>Mempool <span id="mempoolCount" style="font-size: 0.8rem">(Loading)</span></h3>
            <ul id="mempool" style="list-style: none; padding: 0"></ul>
        </div>

        <div>
            <h3>Seeding <span id="seedingCount" style="font-size: 0.8rem">(Loading)</span></h3>
            <ul id="seeding" style="list-style: none; padding: 0"></ul>
        </div>

        <div>
            <h3>Leeching <span id="leechingCount" style="font-size: 0.8rem">(Loading)</span></h3>
            <div id="leeching" style="list-style: none; padding: 0"></div>
        </div>

        <div>
            <h3>Balances <span id="balancesCount" style="font-size: 0.8rem">(Loading)</span></h3>
            <div id="balances" style="list-style: none; padding: 0"></div>
        </div>
    </div>

    <div>
        <h3>Logs</h3>
        <pre id="log"></pre>
    </div>

    <script>
        const infohashTable = {};

        window.electronAPI.handleLog((event, message) => {
            const messageElement = document.createElement('p');
            messageElement.textContent = atob(message);
            document.getElementById('log').appendChild(messageElement);
        });

        window.electronAPI.handleMessage((event, message) => {
            const payload = JSON.parse(atob(message));

            document.getElementById('address').textContent = payload.address;
            document.getElementById('balance').textContent = payload.balances[payload.address] || 0;
            document.getElementById('connections').textContent = payload.connections;

            document.getElementById('peersCount').textContent = '(' + payload.peers.length + ')';
            const peersElement = document.getElementById('peers');
            peersElement.innerHTML = '';
            for (const peer of payload.peers) {
                const peerElement = document.createElement('li');
                peerElement.textContent = peer;
                peersElement.appendChild(peerElement);
            }

            document.getElementById('mempoolCount').textContent = '(' + payload.infohashes.length + ')';
            const mempoolElement = document.getElementById('mempool');
            mempoolElement.innerHTML = '';
            for (const infohash of payload.infohashes) {
                const infohashElement = document.createElement('li');
                if (infohashTable[infohash]) {
                    const txIdLink = document.createElement('a');
                    txIdLink.textContent = infohash;
                    txIdLink.href = 'transaction.html#' + infohashTable[infohash];
                    infohashElement.appendChild(txIdLink);
                } else infohashElement.textContent = infohash;
                mempoolElement.appendChild(infohashElement);
            }

            document.getElementById('seedingCount').textContent = '(' + payload.seeding.length + ')';
            const seedingElement = document.getElementById('seeding');
            seedingElement.innerHTML = '';
            for (const infohash of payload.seeding) {
                const infohashElement = document.createElement('li');
                if (infohashTable[infohash]) {
                    const txIdLink = document.createElement('a');
                    txIdLink.textContent = infohash;
                    txIdLink.href = 'transaction.html#' + infohashTable[infohash];
                    infohashElement.appendChild(txIdLink);
                } else infohashElement.textContent = infohash;
                seedingElement.appendChild(infohashElement);
            }

            document.getElementById('leechingCount').textContent = '(' + payload.leeching.length + ')';
            const leechingElement = document.getElementById('leeching');
            leechingElement.innerHTML = '';
            for (const infohash of payload.leeching) {
                const infohashElement = document.createElement('p');
                infohashElement.textContent = infohash;
                leechingElement.appendChild(infohashElement);
            }

            document.getElementById('balancesCount').textContent = '(' + Object.keys(payload.balances).length + ')';
            const balancesElement = document.getElementById('balances');
            balancesElement.innerHTML = '';
            for (const address in payload.balances) {
                const balanceElement = document.createElement('p');
                const addressLink = document.createElement('a');
                addressLink.textContent = address;
                addressLink.href = 'address.html#' + address;
                balanceElement.appendChild(addressLink);
                balanceElement.textContent += ': ' + payload.balances[address];
                balancesElement.appendChild(balanceElement);
            }

            document.getElementById('transactions').innerHTML = '';
            const transactions = JSON.parse(payload.transactions);
            for (const transaction of transactions) {
                const transactionElement = document.createElement('tr');
                const txIdElement = document.createElement('td');
                const infohashElement = document.createElement('td');
                const fromElement = document.createElement('td');
                const toElement = document.createElement('td');
                const amountElement = document.createElement('td');
                const messageElement = document.createElement('td');

                txIdLink = document.createElement('a');
                txIdLink.textContent = transaction.hash;
                txIdLink.href = 'transaction.html#' + transaction.hash;
                txIdElement.appendChild(txIdLink);

                if (transaction.infohash) {
                    if (!infohashTable[transaction.infohash])
                        infohashTable[transaction.infohash] = transaction.hash;
                    const infohashLink = document.createElement('a');
                    infohashLink.textContent = transaction.infohash;
                    infohashLink.href = 'transaction.html#' + transaction.infohash;
                    infohashElement.appendChild(infohashLink);
                } else infohashElement.textContent = 'N/A';
                
                const fromLink = document.createElement('a');
                fromLink.textContent = transaction.tx.from;
                fromLink.href = 'address.html#' + transaction.tx.from;
                fromElement.appendChild(fromLink);

                const toLink = document.createElement('a');
                toLink.textContent = transaction.tx.to;
                toLink.href = 'address.html#' + transaction.tx.to;
                toElement.appendChild(toLink);

                amountElement.textContent = transaction.tx.amount;
                messageElement.textContent = transaction.tx.message;

                if (transaction.tx.from === payload.address)
                    fromElement.classList.add('highlight-cell');
                else if (transaction.tx.to === payload.address)
                    toElement.classList.add('highlight-cell');

                transactionElement.appendChild(txIdElement);
                transactionElement.appendChild(infohashElement);
                transactionElement.appendChild(fromElement);
                transactionElement.appendChild(toElement);
                transactionElement.appendChild(amountElement);
                transactionElement.appendChild(messageElement);

                document.getElementById('transactions').appendChild(transactionElement);
            }

            document.getElementById('ratio').textContent = payload.ratio;
            document.getElementById('downloadSpeed').textContent = payload.downloadSpeed + 'B/s';
            document.getElementById('uploadSpeed').textContent = payload.uploadSpeed + 'B/s';
            document.getElementById('progress').textContent = payload.progress + '%';
        });
    </script>
</body>
</html>
